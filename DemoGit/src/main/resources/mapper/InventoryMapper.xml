<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.demo.model.mdao.InventoryMapper">
  <resultMap id="BaseResultMap" type="com.demo.pojo.Inventory">
    <id column="inid" jdbcType="INTEGER" property="inid" />
    <result column="inentity" jdbcType="INTEGER" property="inentity" />
    <result column="inoccupy" jdbcType="INTEGER" property="inoccupy" />
    <result column="inusable" jdbcType="INTEGER" property="inusable" />
    <result column="maxcount" jdbcType="INTEGER" property="maxcount" />
    <association property="product" javaType="com.demo.pojo.SpProduct">
      <id column="lid" jdbcType="INTEGER" property="lid" />
      <result column="lname" jdbcType="VARCHAR" property="lname" />
      <result column="lguige" jdbcType="VARCHAR" property="lguige" />
      <result column="ldanwei" jdbcType="VARCHAR" property="ldanwei" />
      <result column="ltiaoma" jdbcType="INTEGER" property="ltiaoma" />
      <result column="lchengben" jdbcType="DECIMAL" property="lchengben" />
    </association>
  </resultMap>

  <update id="updateinentity" parameterType="com.demo.pojo.Inventory">
    <!--
      盘点重置库存
    -->
    update inventory i
    set
    inentity = #{inentity,jdbcType=INTEGER},
    inusable = #{inusable,jdbcType=INTEGER}
    where inid = #{lid}
  </update>
  <update id="updatekucun" parameterType="com.demo.pojo.Inventory">
    <!--
      单品入库加库存
    -->
    update inventory i
    set
    inentity = inentity+#{inentity,jdbcType=INTEGER},
    inusable = inusable+#{inusable,jdbcType=INTEGER}
    where inid = #{lid}
  </update>
  <update id="updatekucunjian" parameterType="com.demo.pojo.Inventory">
    <!--
      单品入库减库存
    -->
    update inventory i
    set
    inentity = inentity-#{inentity,jdbcType=INTEGER},
    inusable = inusable-#{inusable,jdbcType=INTEGER}
    where inid = #{lid}
  </update>
  <update id="updatemaxcount" parameterType="com.demo.pojo.Inventory">
    <!--
      设置超卖数量
    -->
    update inventory i
    set
    i.maxcount=#{maxcount}
    where inid = #{inid}
  </update>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from inventory
    where inid = #{inid,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.demo.pojo.Inventory">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into inventory (inid, lid, inentity, 
      inoccupy, inusable, maxcount
      )
    values (#{inid,jdbcType=INTEGER}, #{lid,jdbcType=INTEGER}, #{inentity,jdbcType=INTEGER}, 
      #{inoccupy,jdbcType=INTEGER}, #{inusable,jdbcType=INTEGER}, #{maxcount,jdbcType=INTEGER}
      )
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.demo.pojo.Inventory">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update inventory
    set
      inentity = #{inentity,jdbcType=INTEGER},
      inoccupy = #{inoccupy,jdbcType=INTEGER},
      inusable = #{inusable,jdbcType=INTEGER},
      maxcount = #{maxcount,jdbcType=INTEGER}
    where inid = #{inid,jdbcType=INTEGER}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select inid,  inentity, inoccupy, inusable, maxcount
    from inventory
    where inid = #{inid,jdbcType=INTEGER}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select inid,  inentity, inoccupy, inusable, maxcount
    from inventory
  </select>

  <select id="selectAndproductAll" resultMap="BaseResultMap">
    <!--
      库存单品连表查询,搜索单品名称，单品条码
    -->
    select *
    from inventory i inner join sp_product sp on i.lid=sp.lid
    <where>
        <if test="lname!=null and lname!=''">
            and sp.lname like concat('%',#{lname},'%')
        </if>
        <if test="ltiaoma!=null and ltiaoma!=''">
            and sp.ltiaoma like concat('%',#{ltiaoma},'%')
        </if>
    </where>
  </select>
</mapper>