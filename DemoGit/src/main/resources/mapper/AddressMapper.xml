<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.demo.model.mdao.AddressMapper">
  <resultMap id="BaseResultMap" type="com.demo.pojo.Address">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="adid" jdbcType="INTEGER" property="adid" />
    <result column="adprovince" jdbcType="VARCHAR" property="adprovince" />
    <result column="adcity" jdbcType="VARCHAR" property="adcity" />
    <result column="adarea" jdbcType="VARCHAR" property="adarea" />
    <result column="addetailed" jdbcType="VARCHAR" property="addetailed" />
    <result column="adisdelete" jdbcType="VARCHAR" property="adisdelete" />
    <result column="adisdefault" jdbcType="VARCHAR" property="adisdefault" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from address
    where adid = #{adid,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.demo.pojo.Address">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into address (adid, cid3, adprovince, 
      adcity, adarea, addetailed, 
      adisdelete, adisdefault)
    values (#{adid,jdbcType=INTEGER}, #{cid3,jdbcType=INTEGER}, #{adprovince,jdbcType=VARCHAR}, 
      #{adcity,jdbcType=VARCHAR}, #{adarea,jdbcType=VARCHAR}, #{addetailed,jdbcType=VARCHAR}, 
      #{adisdelete,jdbcType=VARCHAR}, #{adisdefault,jdbcType=VARCHAR})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.demo.pojo.Address">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update address
    set cid3 = #{cid3,jdbcType=INTEGER},
      adprovince = #{adprovince,jdbcType=VARCHAR},
      adcity = #{adcity,jdbcType=VARCHAR},
      adarea = #{adarea,jdbcType=VARCHAR},
      addetailed = #{addetailed,jdbcType=VARCHAR},
      adisdelete = #{adisdelete,jdbcType=VARCHAR},
      adisdefault = #{adisdefault,jdbcType=VARCHAR}
    where adid = #{adid,jdbcType=INTEGER}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select adid, cid3, adprovince, adcity, adarea, addetailed, adisdelete, adisdefault
    from address
    where adid = #{adid,jdbcType=INTEGER}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select adid, cid3, adprovince, adcity, adarea, addetailed, adisdelete, adisdefault
    from address
  </select>

  <!--根据客户id查询收货地址-->
  <select id="selectByCidAll" resultMap="BaseResultMap">
    select adid,adprovince,adcity,adarea,addetailed,adisdelete,adisdefault
    from address where cid3 = #{cid} and adisdelete = '否' order by adid desc
  </select>
  <!--查询已删除的收货地址-->
  <select id="selectByCidAll1" resultMap="BaseResultMap">
    select adid,adprovince,adcity,adarea,addetailed,adisdelete,adisdefault
    from address where cid3 = #{cid} and adisdelete = '是' order by adid desc
  </select>

  <!--设置默认地址-->
  <update id="updateAdisdefault" parameterType="com.demo.pojo.Address">
    update address set adisdefault = '是' where adid = #{adid}
  </update>
  <update id="updateAdisdefault1" parameterType="com.demo.pojo.Address">
    update address set adisdefault = '否' where adisdefault = '是' and cid3 = #{cid}
  </update>

  <!--修改收货地址信息-->
  <update id="updateAddress" parameterType="com.demo.pojo.Address">
    update address set adprovince = #{adprovince},adcity = #{adcity},
    adarea = #{adarea},addetailed = #{addetailed} where adid = #{adid}
  </update>

  <!--删除收货地址（逻辑删除）-->
  <update id="updateAdisdelete" parameterType="com.demo.pojo.Address">
    update address set adisdelete = '是' where adid = #{adid}
  </update>

  <!--恢复收货地址-->
  <update id="updateAdisdelete1" parameterType="com.demo.pojo.Address">
    update address set adisdelete = '否' where adid = #{adid}
  </update>

  <!--删除收货地址（物理删除）-->
  <delete id="deleteAddress" parameterType="com.demo.pojo.Address">
    delete from address where adid = #{adid}
  </delete>

  <resultMap id="orderResult" type="com.demo.pojo.Orders">
    <id column="o_id" property="oId" />
    <result column="o_date" property="oDate" />
    <result column="pay" property="pay" />
    <result column="price" property="price" />
    <result column="orsip" property="orsip" />
    <result column="remarks" property="remarks" />
    <result column="ortype" property="ortype" />
    <association property="customer" javaType="com.demo.pojo.Customer">
      <id column="cid3" property="cid3"/>
      <result column="cname" property="cname"/>
      <result column="cphone" property="cphone"/>
      <result column="password" property="password"/>
      <result column="chead" property="chead"/>
    </association>
    <association property="address" javaType="com.demo.pojo.Address">
      <id property="adid" column="adid"/>
      <result property="adprovince" column="adprovince"/>
      <result property="adcity" column="adcity"/>
      <result property="adarea" column="adarea"/>
      <result property="addetailed" column="addetailed"/>
      <result property="adisdelete" column="adisdelete"/>
      <result property="adisdefault" column="adisdefault"/>
    </association>
    <collection property="orderinfos" ofType="com.demo.pojo.OrderInfo">
      <id column="oi_id" property="oiId"/>
      <result column="coms" property="coms"/>
      <result column="comprice" property="comprice"/>
    </collection>
  </resultMap>
  <!--分页查询订单、模糊搜索-->
  <select id="selectOrders" resultMap="orderResult">
    select * from orders o
    inner join customer c on o.cid3 = c.cid3
    <where>
      <if test="ortype!='' and ortype!=null">
        and o.ortype like concat('%',#{ortype},'%')
      </if>
      <if test="orsip!='' and orsip!=null">
        and o.orsip like concat('%',#{orsip},'%')
      </if>
        and o.cid3 = #{cid}
    </where>
    order by o.o_id  desc
  </select>
  <!--查看订单详情-->
  <select id="selectOrderxq" resultMap="orderResult">
    select * from orders o
    inner join customer c on o.cid3 = c.cid3
    inner join address a on o.adid = a.adid
    where o.o_id = #{oid}
  </select>

  <resultMap id="orderxqResult" type="com.demo.pojo.OrderInfo">
    <id column="oi_id" property="oiId"/>
    <result column="coms" property="coms"/>
    <result column="comprice" property="comprice"/>
    <association property="com" javaType="com.demo.pojo.SpCommodity">
      <id column="comid" property="comid"/>
      <result column="comiszu" property="comiszu"/>
      <result column="combarcode" property="combarcode"/>
      <result column="comname" property="comname"/>
      <result column="comsameprice" property="comsameprice"/>
      <result column="compricemin" property="compricemin"/>
      <result column="compricemax" property="compricemax"/>
      <result column="commarketprice" property="commarketprice"/>
      <result column="comweight" property="comweight"/>
      <result column="comvolume" property="comvolume"/>
      <result column="comsalesvolume" property="comsalesvolume"/>
      <result column="comsalesstatus" property="comsalesstatus"/>
      <result column="comdata" property="comdata"/>
    </association>
    <association property="order" javaType="com.demo.pojo.Orders">
      <id column="o_id" property="oId" />
      <result column="o_date" property="oDate" />
      <result column="pay" property="pay" />
      <result column="price" property="price" />
      <result column="orsip" property="orsip" />
      <result column="remarks" property="remarks" />
      <result column="ortype" property="ortype" />
    </association>
  </resultMap>
  <!--根据订单id查询商品信息-->
  <select id="selectComxq" resultMap="orderxqResult">
    select * from order_info xq
    inner join sp_commodity com on xq.comid = com.comid
    inner join orders o on xq.o_id = o.o_id
    where xq.o_id = #{oId}
  </select>
</mapper>