<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.demo.model.mdao.OrdersMapper">
    <resultMap id="BaseResultMap" type="com.demo.pojo.Orders">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        <id column="o_id" property="oId"/>
        <result column="o_date" property="oDate"/>
        <result column="pay" property="pay"/>
        <result column="price" property="price"/>
        <result column="orsip" property="orsip"/>
        <result column="remarks" property="remarks"/>
        <result column="ortype" property="ortype"/>
        <collection property="orderinfos" ofType="com.demo.pojo.OrderInfo">
            <id column="oi_id" property="oiId"/>
            <result column="coms" property="coms"/>
            <result column="comprice" property="comprice"/>
            <collection property="com" ofType="com.demo.pojo.SpCommodity">
                <id column="comid" property="comid"/>
                <result column="comiszu" property="comiszu"/>
                <result column="combarcode" property="combarcode"/>
                <result column="comname" property="comname"/>
                <result column="comsameprice" property="comsameprice"/>
                <result column="compricemin" property="compricemin"/>
                <result column="compricemax" property="compricemax"/>
                <result column="commarketprice" property="commarketprice"/>
                <result column="comweight" property="comweight"/>
                <result column="comvolume" property="comvolume"/>
                <result column="comsalesvolume" property="comsalesvolume"/>
                <result column="comsalesstatus" property="comsalesstatus"/>
                <result column="comdata" property="comdata"/>
            </collection>
        </collection>
        <collection property="customer" ofType="com.demo.pojo.Customer">
            <id column="cid3" property="cid3"/>
            <result column="cname" property="cname"/>
            <result column="cphone" property="cphone"/>
            <result column="password" property="password"/>
            <result column="chead" property="chead"/>
        </collection>
        <collection property="address" ofType="com.demo.pojo.Address">
            <id column="adid" property="adid"/>
            <result column="adprovince" property="adprovince"/>
            <result column="adcity" property="adcity"/>
            <result column="adarea" property="adarea"/>
            <result column="addetailed" property="addetailed"/>
            <result column="adisdelete" property="adisdelete"/>
            <result column="adisdefault" property="adisdefault"/>
        </collection>
    </resultMap>
    <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        delete from orders
        where o_id = #{oId,jdbcType=INTEGER}
    </delete>
    <insert id="insert" parameterType="com.demo.pojo.Orders">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        insert into orders (o_id, cid3, o_date,
        pay, price, orsip,
        adid, remarks, ortype
        )
        values (#{oId,jdbcType=INTEGER}, #{cid3,jdbcType=INTEGER}, #{oDate,jdbcType=TIMESTAMP},
        #{pay,jdbcType=VARCHAR}, #{price,jdbcType=DECIMAL}, #{orsip,jdbcType=VARCHAR},
        #{adid,jdbcType=INTEGER}, #{remarks,jdbcType=VARCHAR}, #{ortype,jdbcType=VARCHAR}
        )
    </insert>
    <update id="updateByPrimaryKey" parameterType="com.demo.pojo.Orders">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        update orders
        set cid3 = #{cid3,jdbcType=INTEGER},
        o_date = #{oDate,jdbcType=TIMESTAMP},
        pay = #{pay,jdbcType=VARCHAR},
        price = #{price,jdbcType=DECIMAL},
        orsip = #{orsip,jdbcType=VARCHAR},
        adid = #{adid,jdbcType=INTEGER},
        remarks = #{remarks,jdbcType=VARCHAR},
        ortype = #{ortype,jdbcType=VARCHAR}
        where o_id = #{oId,jdbcType=INTEGER}
    </update>
    <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        select o_id, cid3, o_date, pay, price, orsip, adid, remarks, ortype
        from orders
        where o_id = #{oId,jdbcType=INTEGER}
    </select>
    <select id="selectAll" resultMap="BaseResultMap">
        <!--
          WARNING - @mbg.generated
          This element is automatically generated by MyBatis Generator, do not modify.
        -->
        SELECT * FROM orders o INNER JOIN order_info oi ON o.o_id=oi.o_id
        INNER JOIN sp_commodity spc on oi.comid=spc.comid
        INNER JOIN customer cu on o.cid3=cu.cid3
        INNER JOIN address ad on o.adid=ad.adid
        <where>
            <if test="ortype!='' and ortype!=null">
                and o.ortype like concat('%',#{ortype},'%')
            </if>
            <if test="orsip!='' and orsip!=null">
                and o.orsip like concat('%',#{orsip},'%')
            </if>
            <if test="pay!='' and pay!=null">
                and o.pay like concat('%',#{pay},'%')
            </if>
        </where>
    </select>


    <resultMap id="orinfopicMap" type="com.demo.pojo.picvo">
        <result column="coms" property="coms"/>
        <result column="comprice" property="comprice"/>
        <result column="comname" property="comname"/>
        <result column="picpath" property="picpath"/>
        <result column="cprname" property="cprname"/>
        <result column="cpyname" property="cpyname"/>
    </resultMap>
    <select id="selectcompic" resultMap="orinfopicMap">
    SELECT * FROM order_info oi INNER JOIN orders o ON oi.o_id=o.o_id
    INNER JOIN sp_commodity spc on oi.comid=spc.comid
    INNER JOIN sp_picturetocom sppic ON sppic.comid=spc.comid
    INNER JOIN sp_picture sp ON sppic.picid=sp.picid
	INNER JOIN cprandcom cpr ON spc.comid=cpr.comid
	INNER JOIN sp_commodityparameter spcm ON spcm.cprid=cpr.cprid
	INNER JOIN cpyandcom cpy ON cpy.comid=spc.comid
	INNER JOIN sp_commodityproperty spcp ON cpy.cpyid=spcp.cpyid
    WHERE oi.o_id=#{oId}
  </select>

    <!--根据编号查询订单-->
    <resultMap id="odersMap" type="com.demo.pojo.ordervo">
        <id column="o_id" property="oId"/>
        <result column="o_date" property="oDate"/>
        <result column="pay" property="pay"/>
        <result column="price" property="price"/>
        <result column="orsip" property="orsip"/>
        <result column="remarks" property="remarks"/>
        <result column="ortype" property="ortype"/>
        <result column="cname" property="cname"/>
        <result column="adprovince" property="adprovince"/>
        <result column="adcity" property="adcity"/>
        <result column="adarea" property="adarea"/>
        <result column="addetailed" property="addetailed"/>
    </resultMap>
    <select id="seorder" resultMap="odersMap">
        SELECT * FROM orders o
        INNER JOIN customer cu on o.cid3=cu.cid3
        INNER JOIN address ad on o.adid=ad.adid where o_id=#{oId}
    </select>

    <!--根据订单编号修改状态-->
    <update id="uporder" parameterType="com.demo.pojo.Orders">
        update orders o set o.ortype=#{or.ortype}, o.orsip=#{or.orsip} where o_id=#{or.oId}
    </update>

    <!--查询所有未发货订单-->
    <resultMap id="orderstwoMap" type="com.demo.pojo.Orders">
        <id column="o_id" property="oId"/>
        <result column="o_date" property="oDate"/>
        <result column="pay" property="pay"/>
        <result column="price" property="price"/>
        <result column="orsip" property="orsip"/>
        <result column="remarks" property="remarks"/>
        <result column="ortype" property="ortype"/>
        <collection property="customer" ofType="com.demo.pojo.Customer">
            <id column="cid3" property="cid3"/>
            <result column="cname" property="cname"/>
            <result column="cphone" property="cphone"/>
            <result column="password" property="password"/>
            <result column="chead" property="chead"/>
        </collection>
        <collection property="address" ofType="com.demo.pojo.Address">
            <id column="adid" property="adid"/>
            <result column="adprovince" property="adprovince"/>
            <result column="adcity" property="adcity"/>
            <result column="adarea" property="adarea"/>
            <result column="addetailed" property="addetailed"/>
            <result column="adisdelete" property="adisdelete"/>
            <result column="adisdefault" property="adisdefault"/>
        </collection>
    </resultMap>
    <select id="orderstwo" resultMap="orderstwoMap">
        select * from orders o inner join customer c on o.cid3=c.cid3
        inner  join address a on o.adid=a.adid
        <where>
            <if test="orsip!='' and orsip!=null">
                and o.orsip like concat('%',#{orsip},'%')
            </if>
            <if test="pay!='' and pay!=null">
                and o.pay like concat('%',#{pay},'%')
            </if>
            <if test="1==1">
                and o.ortype='未发货'
            </if>
        </where>
    </select>
</mapper>